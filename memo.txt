現在のブランチの最新状態のファイル一覧(拡張子がymlのみ)の表示
git ls-tree HEAD -r --name-only | grep -E "yml$"

特定のフォルダのファイルを表示する
git ls-tree HEAD -r deployment/ --name-only


❯ git ls-tree HEAD -r deployment/ --name-only
deployment/hoge
deployment/sample.yml
deployment/test-dir/fuga



リモートリポジトリのdeploymentフォルダ内にあるリソースをValidateする
❯ git ls-tree HEAD -r deployment/ --name-only | xargs -L 1 -I FILE echo "kyverno apply ./policies --resource=FILE"
kyverno apply ./policies --resource=deployment/hoge
kyverno apply ./policies --resource=deployment/sample.yml
kyverno apply ./policies --resource=deployment/test-dir/fuga



# github action
name: Manifest Validate by kyverno

on: [push]

jobs:
  validation:
    runs-on: ubuntu-latest
    name: Run kyverno
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Run kyverno
        uses: ./ # Uses an action in the root directory
        with:
          command: |
            git ls-tree HEAD -r deployment/ --name-only
